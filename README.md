
# BTC MLOps Prediction System

æœ¬å°ˆæ¡ˆç‚ºä¸€å¥—ä»¥ MLOps æ¶æ§‹å¯¦ç¾çš„æ¯”ç‰¹å¹£åƒ¹æ ¼é æ¸¬ç³»çµ±ï¼Œé æ¸¬æ¯æœˆ BTC åƒ¹æ ¼çš„æœˆå‡è®ŠåŒ–ç‡ã€‚ç³»çµ±æ•´åˆè³‡æ–™æ›´æ–°ã€è‡ªå‹•æ¨¡å‹è¨“ç·´ã€é æ¸¬çµæœå„²å­˜ã€ç•°å¸¸ç›£æ§èˆ‡æŒ‡æ¨™å¯è¦–åŒ–ï¼Œä¸¦é€é Grafana å„€è¡¨æ¿å‘ˆç¾æ¨¡å‹é æ¸¬èˆ‡ BTC ç›¸é—œæŒ‡æ¨™ã€‚  
æ¡ç”¨ Docker Compose ç®¡ç†å¤šå®¹å™¨æœå‹™ï¼Œçµåˆ MLflowã€Prometheusã€Grafana ç­‰å·¥å…·ï¼Œä¸¦ä»¥ Airflow å®šæœŸæ’ç¨‹é©…å‹•å…¨æµç¨‹ä»»å‹™ï¼Œæ‰“é€ é«˜å¯ç¶­è­·æ€§ã€æ˜“æ“´å±•çš„è‡ªå‹•åŒ–é‡‘èåˆ†æå¹³å°ã€‚


# å°ˆæ¡ˆæ¶æ§‹

```bash
.
â”œâ”€â”€ app/                                 # åœ°ç«¯ä¸»æœå‹™ç¨‹å¼ç›®éŒ„
â”‚   â”œâ”€â”€ configs/                            # åŸ·è¡Œç‰¹å¾µç¯©é¸ controllerï¼Œç”¢å‡ºæ¨¡å‹ç‰¹å¾µè¨­å®šæª”
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/                        # æ§åˆ¶å±¤ï¼Œèª¿åº¦æ•´é«”æµç¨‹æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ update_data_controller.py           # æ§åˆ¶è³‡æ–™æŠ“å–æ›´æ–°æµç¨‹
â”‚   â”‚   â”œâ”€â”€ feature_selection_controller.py     # æ§åˆ¶ç‰¹å¾µå·¥ç¨‹æµç¨‹
â”‚   â”‚   â””â”€â”€ model_training_controller.py        # æ§åˆ¶æ¨¡å‹è¨“ç·´æµç¨‹
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                             # è³‡æ–™å‰è™•ç†èˆ‡ç‰¹å¾µå·¥ç¨‹æµç¨‹æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ data/                               # è³‡æ–™è™•ç†ã€è³‡æ–™è¼‰å…¥ã€ç‰¹å¾µç¯©é¸é‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ data_loader.py                      # ä»¥ç‰¹å¾µè¨­å®šæª”é©…å‹•çš„è¨“ç·´è³‡æ–™å»ºæ§‹æ¨¡çµ„
â”‚   â”‚   â”‚   â”œâ”€â”€ data_preprocessor.py                # ç‰¹å¾µå·¥ç¨‹æ¨¡çµ„ï¼Œæ”¯æ´è³‡æ–™åˆä½µã€æ»¯å¾Œè®Šæ•¸ã€è®ŠåŒ–ç‡ã€æº¢åƒ¹ç‡è¨ˆç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ feature_dataset_builder.py          # æ ¹æ“šæŒ‡å®šå€é–“æ§‹å»ºæ¨¡å‹è¨“ç·´ç”¨ç‰¹å¾µè³‡æ–™é›†
â”‚   â”‚   â”‚   â”œâ”€â”€ feature_engineering.py              # ç‰¹å¾µé¸æ“‡æ¨¡çµ„ï¼Œæ•´åˆç›¸é—œä¿‚æ•¸èˆ‡ XGBoost ç‰¹å¾µé‡è¦æ€§é€²è¡Œè®Šæ•¸ç¯©é¸æ¨¡çµ„
â”‚   â”‚   â”‚   â””â”€â”€ feature_selection_pipeline.py       # è‡ªå‹•åŒ–ç‰¹å¾µé¸æ“‡ä¸»æµç¨‹ï¼Œå„²å­˜æœ€çµ‚è®Šæ•¸è¨­å®šç‚º JSON
â”‚   â”‚   â”‚ 
â”‚   â”‚   â”œâ”€â”€ training/                       # æ¨¡å‹è¨“ç·´èˆ‡è¿½è¹¤æ¨¡çµ„
â”‚   â”‚   â”‚   â”œâ”€â”€ model_training_pipeline.py      # è‡ªå‹•åŒ–æ¨¡å‹è¨“ç·´ä¸»æµç¨‹ï¼Œä¸²æ¥è¨“ç·´èˆ‡è©•ä¼°
â”‚   â”‚   â”‚   â”œâ”€â”€ Regressor.py                    # å°è£å¤šæ¨¡å‹è¿´æ­¸è¨“ç·´é‚è¼¯çš„æ¨¡çµ„
â”‚   â”‚   â”‚   â””â”€â”€ mlflow_handler.py               # è² è²¬å°‡è¨“ç·´éç¨‹èˆ‡çµæœé€å…¥ MLflow è¿½è¹¤
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ database/                       # æ¨¡å‹è¨“ç·´èˆ‡è¿½è¹¤æ¨¡çµ„
â”‚   â”‚       â””â”€â”€ mysql_handler.py                # MySQL è³‡æ–™å¯«å…¥/æŸ¥è©¢/æ›´æ–°ç­‰å°è£é‚è¼¯
â”‚   â”‚
â”‚   â”œâ”€â”€ monitoring/                         # æ¨¡å‹èˆ‡ç³»çµ±ç›£æ§æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ prometheus/                         # Prometheusã€alert_rules ymlè¨­å®šæª”
â”‚   â”‚   â”œâ”€â”€ alertmanager/                       # alertmanager è¨­å®šæª”ï¼Œä¸²é€£ slack webhook
â”‚   â”‚   â”œâ”€â”€ s3_exporters/                       # æŒ‡æ¨™è½‰æ›ç‚º HTTP ç«¯é»ï¼Œä¾› Prometheus æ“·å–
â”‚   â”‚   â””â”€â”€ prometheus_handler.py               # æ•´åˆæŒ‡æ¨™æ¨é€èˆ‡æ ¼å¼åŒ–é‚è¼¯
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                           # è³‡æ–™æœå‹™å±¤ï¼Œè² è²¬è³‡æ–™æŠ“å–ã€æ•´ä½µèˆ‡å­˜å–é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ btc_data_service.py                 # BTCæ•¸æ“š-è³‡æ–™æŠ“å–ã€å­˜å„²é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ macro_data_service.py               # ç¸½ç¶“æ•¸æ“š-è³‡æ–™æŠ“å–ã€å­˜å„²é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ market_metrics_service.py           # éˆä¸Šæ•¸æ“š-è³‡æ–™æŠ“å–(S3)ã€å­˜å„²é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ monthly_update_service.py           # è‡ªå‹•åŒ–è³‡æ–™æ›´æ–°ä¸»æµç¨‹ï¼Œå…¨è³‡æ–™çµ±ä¸€å…¥å£
â”‚   â”‚   â”œâ”€â”€ local_fetcher.py                    # æœ¬åœ°è³‡æ–™æ“·å–å·¥å…·ï¼ˆæ”¯æ´ BTC / ç¸½ç¶“ç­‰é¡åˆ¥ï¼‰
â”‚   â”‚   â””â”€â”€ s3_fetcher.py                       # æœ¬åœ°è³‡æ–™æ“·å–å·¥å…·ï¼ˆæ”¯æ´ S3 è³‡æ–™æŠ“å–é¡åˆ¥ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                              # å·¥å…·æ¨¡çµ„ï¼ˆç„¡æ¥­å‹™é‚è¼¯ï¼Œåƒ…é€šç”¨è¼”åŠ©åŠŸèƒ½ï¼‰
â”‚   â”‚   â”œâ”€â”€ date_utils.py                       # è¨ˆç®—è¨“ç·´èˆ‡æ¸¬è©¦çš„æ™‚é–“å€é–“æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ docker_utils.py                     # åŸ·è¡Œ docker inspect æŸ¥å®¹å™¨ IP æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ file_utils.py                       # å°‹æ‰¾æœ€æ–°æ¨¡å‹ç‰¹å¾µè¨­å®šæª”æ¨¡çµ„
â”‚   â”‚
â”‚   â””â”€â”€ crypto_api_app.py                   # Flask API ä¸»æ‡‰ç”¨é€²å…¥é»ï¼Œæ¥æ”¶ Airflow è§¸ç™¼åŸ·è¡Œè³‡æ–™æ›´æ–°èˆ‡æ¨¡å‹è¨“ç·´
â”‚
â”œâ”€â”€ aws_scheduler/                          # AWS Lambda ä»»å‹™æ¨¡çµ„ï¼ˆé›²ç«¯è³‡æ–™æ’ç¨‹ï¼‰
â”‚   â”œâ”€â”€ lambda_package/                         # Lambda æ‰“åŒ…ä¸Šå‚³çš„å£“ç¸®æª”èˆ‡åŸå§‹ç¢¼
â”‚   â”‚   â”œâ”€â”€ python/                                 # éƒ¨ç½²åˆ° Lambda çš„ Python å¥—ä»¶è³‡æ–™å¤¾ï¼ˆé€é ZIP æ‰“åŒ…ï¼‰
â”‚   â”‚   â””â”€â”€ lambda_package.zip                      # Lambda éƒ¨ç½²ç”¨çš„å®Œæ•´å£“ç¸®æª”ï¼ˆå«å‡½æ•¸èˆ‡ä¾è³´ï¼‰
â”‚   â”‚   
â”‚   â”œâ”€â”€ services/                               # Lambda çš„æ ¸å¿ƒå•†æ¥­é‚è¼¯æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ btc_fetcher.py                          # å°è£ BTC API æŠ“å–èˆ‡ S3 ä¸Šå‚³é‚è¼¯çš„æ¨¡çµ„
â”‚   â”‚ 
â”‚   â”œâ”€â”€ lambda_function.py                      # Lambda å…¥å£æ¨¡çµ„ (handler)
â”‚   â””â”€â”€ requirements.txt                        # Lambda åŸ·è¡Œæ‰€éœ€çš„ä¾è³´æ¸…å–®
â”‚
â”œâ”€â”€ docker-compose/                         # å„²å­˜ MLOps ç³»çµ±çš„å®¹å™¨æ¶æ§‹èˆ‡æœå‹™éƒ¨ç½²è¨­å®šæª”
â”‚   â”œâ”€â”€ mlops.yml                               # å®šç¾© MLOps å®¹å™¨æ¶æ§‹
â”‚   â”œâ”€â”€ dashboard.yml                           # å®šç¾© Grafana å„€è¡¨æ¿ç”¨å®¹å™¨æ¶æ§‹
â”‚   â””â”€â”€ Dockerfile                              # Flask ä¸»æœå‹™çš„å»ºæ§‹èªªæ˜
â”‚
â”œâ”€â”€ .env                                    # é è¨­ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ .gitignore                              # Git å¿½ç•¥é …ç›®è¨­å®š
â””â”€â”€ requirements.txt                        # å°ˆæ¡ˆä¾è³´å¥—ä»¶æ¸…å–®ï¼ˆæœ¬åœ°åŸ·è¡Œä½¿ç”¨ï¼‰
```


# åŠŸèƒ½æ¨¡çµ„

| åŠŸèƒ½æ¨¡çµ„         | å°æ‡‰å®¹å™¨ / æŠ€è¡“               | èªªæ˜ |
|------------------|-------------------------------|------|
| **Flask API**         | `crypto_proj_flask_main_container`     | æä¾› `/run_data_update`ã€`/run_model_training` ç­‰ RESTful ä»‹é¢çµ¦ Airflow èª¿ç”¨ |
| **MLflow Tracking**   | `crypto_proj_mlflow_container`         | è¿½è¹¤æ¨¡å‹å¯¦é©—èˆ‡åƒæ•¸ï¼Œæ”¯æ´ artifact å„²å­˜è‡³ MinIOã€metadata å„²å­˜è‡³ MySQL |
| **MinIO**             | `crypto_proj_minio_container`          | S3-compatible å„²å­˜æœå‹™ï¼Œå­˜æ”¾æ¨¡å‹ artifactã€log ç­‰ |
| **MySQL**             | `crypto_proj_mysql_container`          | å„²å­˜è³‡æ–™åŸå§‹è¨˜éŒ„èˆ‡è™•ç†å¾Œæ•¸æ“š |
| **Prometheus**        | `crypto_proj_prometheus_container`     | æ“·å–ç³»çµ±èˆ‡æ¨¡å‹è¨“ç·´æŒ‡æ¨™ï¼Œé€²è¡Œç›£æ§èˆ‡å‘Šè­¦é‚è¼¯åˆ¤æ–· |
| **Alertmanager**      | `crypto_proj_alertmanager_container`   | æ¥æ”¶ Prometheus å‘Šè­¦ï¼Œä¸¦å¯ä¸²æ¥ LINE / Slack é€šçŸ¥ |
| **Pushgateway**       | `crypto_proj_pushgateway_container`    | æ”¯æ´ä¸»å‹•æ¨é€è‡ªå®šç¾©æŒ‡æ¨™ä¾› Prometheus æ“·å– |
| **S3 Exporter**       | `crypto_proj_s3_exporter_container`    | æŠ“å– BTC api å³æ™‚æ•¸æ“šä¾› Prometheus æ“·å– |
| **Grafana**           | `crypto_proj_grafana_container`        | è¦–è¦ºåŒ–å„€è¡¨æ¿ï¼Œå¾ Prometheusã€MySql æ“·å–é¡¯ç¤ºæ¨¡å‹è¨“ç·´çµæœèˆ‡ BTC ç›¸é—œæ•¸æ“š |


#VVV#####################################################################################

## ğŸ”§ å•Ÿå‹•å°ˆæ¡ˆ

### 1ï¸âƒ£ è¤‡è£½å°ˆæ¡ˆä¸¦å»ºç«‹ç’°å¢ƒè®Šæ•¸

```bash
git clone https://github.com/yourname/btc-mlops.git
cd btc-mlops
cp .env.example .env
# è«‹ä¾ç…§èªªæ˜å¡«å…¥ MinIOã€MySQL ç­‰é€£ç·šè³‡è¨Š
```

### 2ï¸âƒ£ å•Ÿå‹•æ‰€æœ‰å®¹å™¨

```bash
docker compose -f docker-compose/mlops.yml -p crypto_proj --env-file .env up -d
```


## âš™ï¸ æ ¸å¿ƒç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | èªªæ˜ |
|------|------|
| `MLFLOW_BACKEND_URI` | MLflow ä½¿ç”¨çš„ MySQL è³‡æ–™åº« |
| `MLFLOW_ARTIFACT_URI` | Artifact å„²å­˜ä½ç½® (e.g. `s3://mlflow-artifacts`) |
| `MLFLOW_S3_ENDPOINT_URL` | MinIO çš„ endpointï¼Œè‡ªå‹•é€é docker inspect å¯«å…¥ `.env.runtime` |
| `MYSQL_*`ã€`MINIO_*` | ç›¸é—œé€£ç·šè¨­å®š |

#^^^#####################################################################################


## ğŸ“¡ API ä¸€è¦½

- `POST /run_data_update`ï¼šæ›´æ–°è³‡æ–™ä¾†æºï¼Œå¯«å…¥ MySQL
- `POST /run_model_training`ï¼šè¨“ç·´æ¨¡å‹ä¸¦å°‡çµæœé€å…¥ MLflow + æ¨é€æŒ‡æ¨™åˆ° Prometheus
#VVV#####################################################################################
- `POST /`ï¼š
#^^^#####################################################################################


## ç›£æ§èˆ‡å¯è¦–åŒ–

- Grafana é¡¯ç¤º BTC ç›¸é—œæŒ‡æ¨™æ•¸æ“šã€æ¨¡å‹é æ¸¬çµæœã€æ¨¡å‹è©•ä¼°æŒ‡æ¨™
- Prometheus æ¯æœˆæŠ“å–æœ€æ–°è¨“ç·´æŒ‡æ¨™
- Alertmanager è¶…éé–€æª»è‡ªå‹•é€šçŸ¥ (æ­¤å°ˆæ¡ˆæ•´åˆ Slack é€šçŸ¥)

# æ¸¬è©¦èˆ‡éƒ¨ç½²å»ºè­°

- **Airflow**ï¼šå·²è¦åŠƒç‚º DAG æ’ç¨‹è‡ªå‹•åŒ–è³‡æ–™æ›´æ–°èˆ‡æ¨¡å‹è¨“ç·´
- **DevContainer**ï¼šæ•´åˆ VS Code Dev Containerï¼Œä¾¿æ–¼å”ä½œé–‹ç™¼


